<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>新規会員登録</title>
  <script src="config.js"></script>
  <style>
    :root {
      --bg: #eafaf1;
      --text: #0b3d1e;
      --primary: #2ecc71;
      --primary-hover: #28b463;
      --card: #ffffff;
      --border: #c7f0d6;
    }
    * { box-sizing: border-box; }
    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans JP", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 16px;
    }
    .container {
      width: 100%;
      max-width: 720px;
      background-color: var(--card);
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(11,61,30,0.06);
    }
    h2 { margin: 0 0 8px; text-align: center; color: var(--primary); font-size: 1.25rem; }
    h3 { margin: 0 0 24px; text-align: center; font-weight: 500; color: #145a32; font-size: 1rem; }
    .field {
      display: grid;
      grid-template-columns: 120px 1fr;
      gap: 12px;
      align-items: center;
      margin-bottom: 14px;
    }
    .field label { justify-self: end; color: var(--text); }
    .field input[type="text"],
    .field input[type="email"],
    .field input[type="tel"],
    .field input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 16px;
      background-color: #fbfff9;
      color: var(--text);
    }
    .field input::placeholder { color: #8aa995; }
    .actions { margin-top: 12px; display: flex; justify-content: center; align-items: center; gap: 12px; flex-wrap: wrap; }
    button[type="submit"] {
      min-width: 140px;
      background-color: var(--primary);
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 2px 8px rgba(46,204,113,0.16);
    }
    button[type="submit"]:hover { background-color: var(--primary-hover); }
    .note { margin-top: 12px; font-size: 12px; color: #547a5f; text-align: center; }
    .link { margin-top: 16px; text-align: center; }
    .link a { color: var(--primary); text-decoration: none; }
    .link a:hover { text-decoration: underline; }

    @media (max-width: 520px) {
      .field { grid-template-columns: 1fr; }
      .field label { justify-self: start; }
    }
  </style>
</head>
<body>
  <div class="container">
    <form id="registration-form" novalidate>
      <h2><strong><em>JTB Web販 AWS勉強会 新規会員登録サイト</em></strong></h2>
      <h3>必要事項をご記入の上、登録ボタンを押してください</h3>

      <div class="field">
        <label for="id">ユーザID</label>
        <input autocomplete="off" id="id" inputmode="latin" name="id" placeholder="user-001" required type="text"/>
      </div>

      <div class="field">
        <label for="name">名前</label>
        <input autocomplete="name" id="name" name="name" placeholder="Tetsuya Suzuki" required type="text"/>
      </div>

      <div class="field">
        <label for="email">メールアドレス</label>
        <input autocomplete="email" id="email" name="email" placeholder="tetsuya.suzuki@dxc.com" required type="email"/>
      </div>

      <div class="field">
        <label for="age">年齢</label>
        <input id="age" inputmode="numeric" min="0" name="age" placeholder="35" step="1" type="number"/>
      </div>

      <div class="field">
        <label for="address">住所</label>
        <input id="address" name="address" placeholder="Tokyo, Japan" type="text"/>
      </div>

      <div class="field">
        <label for="tel">電話番号</label>
        <input autocomplete="tel" id="tel" name="tel" placeholder="080-1234-5678" type="tel"/>
      </div>

      <div class="actions">
        <button id="register" type="submit">登録</button>
      </div>

      <p class="note">このフォームは id・name・email・age・address・tel を送信します。</p>

      <div class="link">
        <a href="https://jtb.com/" rel="noopener noreferrer" target="_blank">JTB Web販 AWS 勉強会へ</a>
      </div>
    </form>
  </div>

  <script>
    // 確認ログ（デバッグ用：確認後は削除してOK）
    console.log("registration script loaded", new Date().toISOString());
    console.log("window.env:", window.env);

    // DOM が準備できたら初期化
    window.addEventListener('DOMContentLoaded', () => {
      console.log("DOMContentLoaded fired");
      const form = document.getElementById("registration-form");
      if (!form) {
        console.error("フォーム要素が見つかりません。id=registration-form を確認してください。");
        return;
      }

      const endpoint = window.env && window.env.VITE_API_ENDPOINT;
      console.log("endpoint:", endpoint);
      if (!endpoint || typeof endpoint !== "string") {
        console.error("API endpoint が未設定です。config.js の展開を確認してください。");
        return;
      }

      const validate = ({ id, name, email, age, tel }) => {
        if (!id || !name || !email) {
          alert("すべての必須項目（ID・名前・メールアドレス）を入力してください。");
          return false;
        }
        const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRe.test(email)) {
          alert("メールアドレスの形式が正しくありません。");
          return false;
        }
        if (age !== "" && age !== null && age !== undefined) {
          const n = Number(age);
          if (!Number.isInteger(n) || n < 0) {
            alert("年齢は0以上の整数で入力してください。");
            return false;
          }
        }
        if (tel) {
          const telRe = /^[0-9\-+\s]{8,20}$/;
          if (!telRe.test(tel)) {
            alert("電話番号の形式が正しくありません。");
            return false;
          }
        }
        return true;
      };

      const submitButton = document.getElementById("register");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        // 多重送信防止
        if (submitButton) submitButton.disabled = true;